非常开心能在预赛上 AK~（毕竟是马拉松

题出得很妙，后面几题都想了挺久的……人傻没办法 qwq

最后为了不被狙击（？）课上疯狂爆破 N 题，爆破了一个多小时爆破掉了，于是就 AK 了~

今晚来摸个简略题解，摸完就去写作业 T^T

[CF 上的比赛镜像](http://codeforces.com/gym/306057)

#### A 三角形切半

签到

#### B 连接美国

并查集

签到（我为什么会这题 WA 两次？

#### C 数码管

样例已经告诉你答案应该是 $6^{\lfloor n/2 \rfloor}\times 4^{n \bmod 2}$

直接快速……幂不动，出题人非常良 (du) 心 (liu) 地把数据范围出到了 $10^{10^5}$，怎么办呢？

直接上欧拉定理求 $6^{\lfloor n/2 \rfloor \bmod 9982444352}\times 4^{n \bmod 2}$ 就行了 = =||

998244353*1

#### D 颤弦蝾螈与 PCPC

首先如果 $a_i\geq x$ 那么这道题选择读错题一定更优，直接令 $a_i=x$。

为了令通过题数最多，以 $a_i$ 从小到大的顺序依次做题即可。

如何求出最少罚时？以 $a_i$ 从大到小的顺序枚举每一题，若这一题不 debug 而读题更优就调整为读题就可以了。时间复杂度 $O(n\log n)$。

#### E 游戏分组

设 $f(i,j)$ 表示当前选了 $i$ 轮人，选出来了 $i$ 个组，一个组在不同轮选出来视为不同方案，剩余 $j$ 个人的方案数。则有转移 $f(i,j)=\sum\_{k}f(i-1,j+a\_k)C\_{j+a\_k}^{a\_k}$，初始时 $f(0,n)=1$。

若是一个组在不同轮选出来视为同一方案，最终若是分了 $p$ 个组，这个分组方案会在 DP 的时候被计入 $p!$ 次，除掉就好了。

答案就是 $\sum_{p=1}^n {f(p,0)\over p!}$。时间复杂度 $O(n^3)$。

998244353*2

#### F 推箱子

大模拟 BFS

#### G easy segment problem

若是两个奇点距离的平方最大，这两个奇点在每条线段上选择的点只会是互异的端点。那么我们直接把每条线段当成一个向量，现在的问题就是，给每个向量 $\vec v\_i$ 分配一个系数 $1$ 或 $-1$，使得向量之和的模长最大。

由于 $\vec v\_i$ 和 $-\vec v\_i$ 在最优解中不会被同时选择，问题转化成在这 $2n$ 个向量里选出来一组向量，使得向量之和的模长最大。

假设最后选出来的向量的和是 $\vec v$，那么选中的向量 $\vec v\_i$一定满足 $\vec v\_i \cdot \vec v> 0$，垂直于 $\vec v$ 的向量可选可不选。可以发现选中的向量都在过原点的某条直线一侧。

所以这 $2n$ 个向量极角排序之后，每次选取连续 $n$ 个向量，取这些向量之和的模长平方最大值就是答案了。

时间复杂度 $O(n\log n)$。

#### H 还原神作

最大总价值贪心地选取最左最右配对，次左次右配对，一路配对 $k$ 个就可以了。

最小总价值是可撤销贪心，可以开个堆解决。时间复杂度 $O(n\log n)$。

#### I 随机游走

令 $f(i,j)$ 表示人在左侧，左侧走过了 $i$ 个点，右侧走过了 $j$ 个点时，走到终态的期望步数；$g(i,j)$ 表示人在右侧的期望步数。由定义可知：
$$f(i,j)=1+{jg(i,j)+(m-j)g(i,j+1)\over m}\\g(i,j)=1+{if(i,j)+(n-i)f(i+1,j)\over n}$$

采用经典套路，设 $f(i,j)=kg(i,j)$ 代入消元即可求得 $f(i,j)$ 与 $g(i,j)$ 递推式，边界条件 $f(n,m)=g(n,m)=0$。最后 ${nf(1,0)+mg(0,1)\over n+m}$ 就是答案。时间复杂度 $O(nm)$。

998244353*3

#### J 期望步数

对所有串建立广义 SAM，可以发现，如果可以从一个字符串 $S$ 走到另一个字符串 $T$，那么在 parent tree 上 $T$ 对应的结点是 $S$ 某个前缀对应结点的祖先。

按字符串长度从小到大的顺序处理每个字符串，并把它的期望放在对应结点上，相同字符串只在对应结点计入一次。

对于一个字符串，我们需要求出它所有子串对它期望的贡献。依次枚举每个前缀，求出前缀对应结点（如果前缀是原串的话则是对应结点的 parent）到根的路径上，所有结点对应字符串的期望之和，求和之后除非自身的子串个数再 $+1$ 就是这个字符串的期望。

结点到根路径和可以按 parent tree 的 DFS 序开一个树状数组。最后对每个字符串的期望取平均就是答案。时间复杂度 $O(\sum |s_i|\log n)$。

998244353*4

#### K 抽鬼牌，打伤害

$a_i, b_i$ 范围只有 $20$，先状压表示手牌。

第一个小目标是求出 Alice 和 Bob 两人结算时，每个剩余手牌状态，有多少种可能开局数。注意到对子都被去掉了，所以一个区间的牌到最后剩余手牌的状态就是 $\oplus\_{i=l}^r 2^{i-1}$，$\oplus$ 表示异或。先求出牌组异或前缀和，两两异或就可以得到所有开局情况剩余手牌的状态。FWT xor 加速计算，注意去掉不合法的空区间并去重。

第二个小目标是求出 Alice 对 Bob 的伤害。若 Alice 的剩余手牌状态为 $a$，Bob 为 $b$，那么造成伤害的状态为 $a\oplus(a\wedge b)=a\wedge(\neg b)$，其中第 $i$ 位为 $1$ 表示乘上 $i$。所以 Bob 算出来的剩余手牌状态取反之后 FWT and 加速，就可以求出来每个造成伤害的状态对应方案数了。枚举状态暴力算系数再求和就可以了。Bob 对 Alice 同理。

时间复杂度 $O(20\times 2^{20})$。

#### L 子集大小和

把询问放在 DFS 序上跑莫队，推一推式子就可以维护答案了。时间复杂度 $O(n\sqrt n)$。

998244353*5

#### M 普通的集合

首先设 $f(n)$ 表示元素最大为 $n$ 的集合数，$g(n)$ 表示元素最大为 $n$ 的集合的所有元素和，那么 $\sum\_{i=1}^n g(i)$ 就是答案了。可以得到递推式：
$$f(n)=1+\sum\_{d|n\wedge d\neq n}f(d)\\g(n)=nf(n)+\sum\_{d|n\wedge d\neq n}g(d)$$

把右边的 $f(d),g(d)$ 移到左边就可以写成卷积形式：
$$\sum\_{d|n}f(d)A\left(n\over d\right)=1\\\sum\_{d|n}g(d)A\left(n\over d\right)=nf(n)$$

其中 $A(n)=\begin{cases} 1&,n=1\\ -1&,n>1\end{cases}$。为了套杜教筛我们应该要求 $nf(n)$ 的前缀和。把上面那条式子改改：
$$\sum\_{d|n}df(d)\left[{n\over d}A\left(n\over d\right)\right]=n$$

$A(n),nA(n)$ 的前缀和都很容易求，所以杜教筛就可以了。

998244353*6

#### N 风与牧场与集市

一看见实数答案估摸着就是二分答案，一看见乱七八糟的限制估摸着是高级建图跑网络流。然而作为一只菜狗并不会 T^T

但是 $n\leq 40$ 范围非常小，大力模拟退火。

先传递闭包把选每个物品要关联的所有物品找出来，然后 for 个 $6$ 次，每次拿每个物品作为初始状态大力模拟退火，然而 WA 了无数次。

想了想觉得可能会随机着随机着越跑越偏跑不回最优解，于是加了个试错 $20$ 次还没能更新当前解，就重置回本轮之前找到的最优解开始重新随机，然后就 AC 了（_(:3__

就酱 =w=（所以说出题人到底多喜欢 998244353？